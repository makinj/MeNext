function register(){return $.post("handler.php",$("#register").serialize(),function(e){var t=JSON.parse(e);"success"==t.status?window.location.href="/":$("#register_problem").html('<div class="alert alert-danger" role="alert">'+t.errors[0]+"</div>")}),!1}function login(){return $.post("handler.php",$("#login").serialize(),function(e){var t=JSON.parse(e);"success"==t.status?window.location.href="/":$("#login_problem").html('<div class="alert alert-danger" role="alert">'+t.errors[0]+"</div>")}),!1}function searchYouTube(){return""!=$("#searchText").val()?$.get("https://www.googleapis.com/youtube/v3/search?part=snippet&order=relevance&type=video&maxResults=25&q="+$("#searchText").val()+"&key="+YT_API_KEY,function(e,t){"success"==t?listSearchResults(e):$("#searchResults").html("Failed :("),$("button.addVideo").click(function(){$(this).attr("disabled",!0),submitVideo($(this).val()),$(this).attr("class","btn btn-default btn-lg"),$(this).html("<span class='glyphicon glyphicon-play'></span>"),listQueue()})}):$("#searchResults").html("Enter Search term"),0}function listSearchResults(e){$("#searchResults").html("");for(var t=e.items,n=0;n<t.length;n++)$("#searchResults").append("<tr><td>"+(n+1).toString()+"</td><td><button class='addVideo btn btn-default btn-lg' value='"+t[n].id.videoId+"'><span class='glyphicon glyphicon-plus'></span></button></td><td><img src='"+t[n].snippet.thumbnails.default.url+"'/></td><td>"+t[n].snippet.title+"</td><td>"+t[n].snippet.description+"</td></tr>")}function createParty(){return $.post("handler.php",$("#createPartyForm").serialize(),function(e){var t=JSON.parse(e);"success"==t.status?window.location.href="/party.php?partyId="+t.partyId:$("#problem").html(t.errors[0])}),!1}function joinParty(e){$.post("handler.php",{action:"joinParty",partyId:e},function(t){var n=JSON.parse(t);"success"==n.status?window.location.href="/party.php?partyId="+e:$("#problem").html(n.errors[0])})}function listQueue(){$(document).ready(function(){loadCurrentVideo(),$.get("handler.php?action=listVideos&partyId="+partyId,function(e){var t=JSON.parse(e);if("success"==t.status){var n=t.videos;$("#queueList").html("");for(var s=0;s<n.length;s++){upClass="songUpvote btn btn-default",downClass="songDownvote btn btn-default",n[s].userRating>0&&(upClass="songUnvote btn btn-primary"),n[s].userRating<0&&(downClass="songUnvote btn btn-danger");var r="<tr><td>"+(s+1).toString()+"</td><td>"+n[s].title+"</td><td>"+n[s].username+"</td><td><div class='btn-group btn-group-sm'><button class='"+upClass+"' value='"+n[s].submissionId+"'><span class='glyphicon glyphicon-thumbs-up'></button><button class='"+downClass+"' value='"+n[s].submissionId+"'><span class='glyphicon glyphicon-thumbs-down'></button>";("undefined"!=typeof isAdmin&&1==isAdmin||userId==n[s].submitterId)&&(r=r+"<button class='removeVideo btn btn-default' value='"+n[s].submissionId+"'><span class='glyphicon glyphicon-remove'></button>"),r=r+"</div></td><td>"+n[s].rating+"</td></tr>",$("#queueList").append(r)}$("button.removeVideo").click(function(){$(this).attr("disabled",!0),removeVideo($(this).val()),listQueue(),$(this).val()==window.currentVideo.submissionId&&("undefined"!=typeof window.player&&(window.player.stopVideo(),window.player.clearVideo()),loadCurrentVideo())}),$("button.songUpvote").click(function(){$(this).attr("disabled",!0),upVote($(this).val()),listQueue()}),$("button.songDownvote").click(function(){$(this).attr("disabled",!0),downVote($(this).val()),listQueue()}),$("button.songUnvote").click(function(){$(this).attr("disabled",!0),unVote($(this).val()),listQueue()})}else $("#problem").html(t.errors[0])})})}function loadCurrentVideo(){$(document).ready(function(){$.get("handler.php?action=getCurrentVideo&partyId="+partyId,function(e){var t=JSON.parse(e);if("success"==t.status){var n=t.video;n?("undefined"==typeof window.currentVideo||window.currentVideo.submissionId!=n.submissionId)&&("undefined"!=typeof window.player&&"undefined"!=typeof isAdmin&&1==isAdmin?($("#youtubePlayerParent").show(),window.currentVideo=n,window.player.loadVideoById(n.youtubeId,0)):("undefined"==typeof isAdmin||0==isAdmin)&&(window.currentVideo=n),$("#currentThumbnail").attr("src",n.thumbnail),$("#viewOnYoutube").attr("href","https://www.youtube.com/watch?v="+n.youtubeId),$("#currentTitle").html(n.title),$("#currentDescription").html(n.description)):"undefined"!=typeof window.player&&(state=window.player.getPlayerState(),-1!=state&&0!=state&&5!=state&&window.player.pauseVideo())}else t.errors&&$("#problem").html(t.errors[0])})})}function markVideoWatched(){$.post("handler.php",{action:"markVideoWatched",submissionId:window.currentVideo.submissionId},function(e){var t=JSON.parse(e);"success"!=t.status&&t.errors&&$("#problem").html(t.errors[0])})}function removeVideo(e){$.post("handler.php",{action:"removeVideo",submissionId:e},function(e){var t=JSON.parse(e);"success"!=t.status&&$("#problem").html(t.errors[0])})}function deleteParty(e){$.post("handler.php",{action:"deleteParty",partyId:e},function(e){var t=JSON.parse(e);"success"!=t.status&&$("#problem").html(t.errors[0]),location.reload()})}function unjoinParty(e){$.post("handler.php",{action:"unjoinParty",partyId:e},function(e){var t=JSON.parse(e);"success"!=t.status&&$("#problem").html(t.errors[0]),location.reload()})}function upVote(e){$.post("handler.php",{action:"vote",direction:1,submissionId:e},function(e){var t=JSON.parse(e);"success"!=t.status&&$("#problem").html(t.errors[0])})}function downVote(e){$.post("handler.php",{action:"vote",direction:-1,submissionId:e},function(e){var t=JSON.parse(e);"success"!=t.status&&$("#problem").html(t.errors[0])})}function unVote(e){$.post("handler.php",{action:"vote",direction:0,submissionId:e},function(e){var t=JSON.parse(e);"success"!=t.status&&$("#problem").html(t.errors[0])})}function getSubmissionId(){$(document).ready(function(){var e=null;return $.get("handler.php?action=getCurrentVideo&partyId="+partyId,function(t){var n=JSON.parse(t);if("success"==n.status){var s=n.video;s&&(e=s.submissionId)}else $("#problem").html(n.errors[0])}),e})}function submitVideo(e){$.post("handler.php",{action:"addVideo",partyId:partyId,youtubeId:e},function(e){var t=JSON.parse(e);"success"!=t.status&&$("#problem").html(t.errors[0])})}function onYouTubePlayerReady(){window.player=document.getElementById("youtubePlayer"),window.player.addEventListener("onStateChange","playerStateHandler")}function playPause(){window.player&&(1==window.player.getPlayerState()?window.player.pauseVideo():(0==window.player.getPlayerState()||2==window.player.getPlayerState())&&window.player.playVideo())}function playerStateHandler(e){-1==e?loadCurrentVideo():0==e?(markVideoWatched(),listQueue(),loadCurrentVideo()):1==e?$("#playPause").html('<span class="glyphicon glyphicon-pause">'):2==e&&$("#playPause").html('<span class="glyphicon glyphicon-play">')}function setupYouTube(){var e={allowScriptAccess:"always",allowFullscreen:"true"},t={id:"youtubePlayer"};swfobject.embedSWF("//www.youtube.com/v/00000000000?version=3&enablejsapi=1&iv_load_policy=3&autohide=1&showinfo=0","youtubePlayerParent","100%","250","8",null,null,e,t)}function fullScreenChangeHandler(){var e=document.getElementById("youtubePlayer");(e&&0==document.fullScreen||1==document.msFullscreenEnabled||0==document.mozFullScreen||0==document.webkitIsFullScreen)&&(null!=document.msFullscreenElement?(e.style.width=screen.width+"px",e.style.height=screen.height+"px"):(e.style.width="100%",e.style.height="645px"),document.removeEventListener("fullscreenchange",fullScreenChangeHandler,!1),document.removeEventListener("mozfullscreenchange",fullScreenChangeHandler,!1),document.removeEventListener("webkitfullscreenchange",fullScreenChangeHandler,!1))}function fullScreen(){var e,t=document.getElementById("youtubePlayer"),n=!1,s=!0;if(null!=window.mozInnerScreenX&&(-1!=navigator.appVersion.indexOf("Linux")||-1!=navigator.appVersion.indexOf("X11")||-1!=navigator.appVersion.indexOf("Windows")&&navigator.appVersion.indexOf("Windows")>5)){s=!1;var r=document.getElementById("fullScreen");r.className+=" disabled"}s?(t.requestFullscreen?(t.requestFullscreen(),n=!0):t.msRequestFullscreen?(t.msRequestFullscreen(),n=!0):t.mozRequestFullScreen?(t.mozRequestFullScreen(),n=!0):t.webkitRequestFullscreen&&(t.webkitRequestFullscreen(),n=!0),n&&(t.style.width=screen.width+"px",t.style.height=screen.height+"px",document.addEventListener("fullscreenchange",fullScreenChangeHandler,!1),1!=e&&(document.addEventListener("MSFullscreenChange",fullScreenChangeHandler,!1),e=!0),document.addEventListener("mozfullscreenchange",fullScreenChangeHandler,!1),document.addEventListener("webkitfullscreenchange",fullScreenChangeHandler,!1))):(document.getElementById("disabledFullScreen").style.display="block",$("#disabledFullScreen").children().click(function(){$("#disabledFullScreen").hide()}))}function getCookie(e){for(var t=e+"=",n=document.cookie.split(";"),s=0;s<n.length;s++){for(var r=n[s];" "==r.charAt(0);)r=r.substring(1);if(-1!=r.indexOf(t))return r.substring(t.length,r.length)}return""}$.fn.googleSuggest=function(e){e=$.extend({service:"web",secure:!1},e);var t={youtube:{client:"youtube",ds:"yt"},books:{client:"books",ds:"bo"},products:{client:"products-cc",ds:"sh"},news:{client:"news-cc",ds:"n"},images:{client:"img",ds:"i"},web:{client:"psy",ds:""},recipes:{client:"psy",ds:"r"}},n=t[e.service];return e.source=function(e,t){$.ajax({url:"//clients1.google.com/complete/search",dataType:"jsonp",data:{q:e.term,nolabels:"t",client:n.client,ds:n.ds},success:function(e){t($.map(e[1],function(e){return{value:$("<span>").html(e[0]).text()}}))}})},e.delay=50,e.autoFocus=!0,this.each(function(){$(this).autocomplete(e)})},$(document).ready(function(){if($("#youtubePlayerParent").length>0&&(setupYouTube(),$("#playPause").click(playPause)),$("#searchText").googleSuggest({service:"youtube"}),$("#register").submit(register),$("#login").submit(login),$("#createPartyForm").submit(createParty),$(".joinPartyButton").click(function(){joinParty($(this).attr("value"))}),$(".deletePartyButton").click(function(){var e=confirm("Are you sure you want to delete this party forever?");1==e&&deleteParty($(this).attr("value"))}),$(".unjoinPartyButton").click(function(){var e=confirm("Are you sure you want to unjoin this party?");1==e&&unjoinParty($(this).attr("value"))}),$("#queueList").length>0){{window.setInterval(listQueue,5e3)}listQueue()}}),function(e){e.fn.toggleDisabled=function(){return this.each(function(){this.disabled=!this.disabled})}}(jQuery);